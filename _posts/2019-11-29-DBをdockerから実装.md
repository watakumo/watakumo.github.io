---
title: DBをdockerから実装
tags: [laravel, docker, mysql]
style: fill
color: secondary
description: laravelでMYSQLをdockerからCONNECTしてみました。
---

![](https://miro.medium.com/max/1200/1*8VJ2bu7HYFdRxF9LkCu5wA.jpeg)

今日はDockerでMysqlを起動してLaravelに連結してみました。

WINDOW10 HOMEでの実装になります。

# なぜ、MYSQLをDockerに？

Laravel６のデフォルトmigrateが、Mysql 5.xxではできないことと、

MysqlのアップデートがWINDOWでは意外とややこしくて、

Dockerを使うことにしました。

実務では開発用サーバがちゃんと分かれていて、

環境構築って、社内共通環境だったのでgit cloneを使うと

普通にできていたので、そこまで難しいことがなかったです。

でも、ビルドやデプロイが頻繁なウェブ業界ではやはり必須のようです。

であれば、全力で使ってみるべきですね。

# 使い方


## toolboxインストール

参考にしてもらったのはこっちです。

<https://docs.docker.com/toolbox/toolbox_install_windows/>

Windows10 Homeでの実装なので、VM基板で動く **toolbox** というものをインストールします。

<https://github.com/docker/toolbox/releases>

## dockerのソフトウェア

- kitematic
- Docker Compose for Windows

インストールするときに上記のものもインストールするかを聞かれます。

Composeは複数のContainerを使う時に要ります。今回は特に気にしなくてもいいですね。

メニューには書いていませんが、Docker Quickstart Terminalをインストールされます。


## toolboxインストール
```sh
# インストール確認
docker -v
# mysqlイメージ確認
docker search mysql
# 最新パージョンPULL
docker pull mysql
# docker images確認
docker images
# コンテイナー作成
docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=password --name mysql_laravel mysql
# コンテイナー状態確認
docker ps -a
# mysqlコンテイナーに接続
docker exec -i -t mysql_laravel bash
# mysqlサーバへ接続
mysql -u root -p

```

dockerをGUIで操作ができるkitematicでも確認をしてみます。


# Laravel６ではCONNECTライブラリがMYSQL８の認証方法支援しない

PHPのIDEからDB接続をしてみたら...

```
PDOException::("PDO::__construct(): The server requested authentication method unknown to the
client[caching_sha2_password]")
```
そんな...。まさかのことが...。

Mysql8で使う認証方法をlaravel6のライブラリでは支援してないのです。

<https://qiita.com/ucan-lab/items/3ae911b7e13287a5b917>

でも、上記を参考しUserの認証設定を　**mysql_native** 変えるできました。

次から必ず、Postgreを使うことにします。

```mysql
SELECT user, host, plugin FROM mysql.user
ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'password'
```

dockerでインストールしたIPは下記で調べられます。
localhostではないので、住所が変わるようです。

```sh
docker-machine ip default
```
